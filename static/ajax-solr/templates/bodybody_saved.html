<div class="full"> 

  {{#notloggedin}}
  <!-- TODO: make 'log in' be a link. -->
  <div>
    Please log in to see your saved items.
 </div>
  {{/notloggedin}}

  {{^notloggedin}}
 <div class="saved-items">
   {{#hassearches}}
  <h1>Saved Searches</h1>
  <form id="saved-searches-form" action="#">
  <input type="submit" name="action" value="Delete marked searches">
  <input type="button" value="Mark all" onClick="changeAllButtons(this.form, true)">
  <input type="button" value="Clear all" onClick="changeAllButtons(this.form, false)">
{{#savedsearches}}
  <div id="search-{{searchctr}}">
    <input type="checkbox" name="searchid" value="{{searchuri}}">
    {{searchpre}}
    <a href="/semantic2/alpha/explorer/publications#{{searchuri}}">{{searchtext}}</a>
  </div>
 {{/savedsearches}}
 </form>
  {{/hassearches}}
  {{^hassearches}}
  <h1>No saved searches</h1>
  {{/hassearches}}
 </div>

  <div class="saved-items">
    {{#haspubs}}
  <h1>Saved Publications</h1>
  <form id="saved-pubs-form" action="#">
 <input type="submit" name="action" value="Delete marked publications">
  <input type="button" value="Mark all" onClick="changeAllButtons(this.form, true)">
  <input type="button" value="Clear all" onClick="changeAllButtons(this.form, false)">
    {{#savedpubs}}
    <div id="pub-{{pubctr}}">
      <input type="checkbox" name="pubid" value="{{{pubid}}}">
      {{linkpre}}
      <a href="/semantic2/alpha/explorer/publications#fq={{linkuri}}&q=*%3A*">{{{linktext}}}</a>
    </div>
    {{/savedpubs}}
    </form>
    {{/haspubs}}
    {{^haspubs}}
    <h1>No saved publications</h1>
    {{/haspubs}}
    </div>
{{/notloggedin}}
	<!-- I assume this is a sensible time to add the handlers -->
	<script type='text/javascript'>
function changeAllButtons(form, newstate) {
  $(form).find('input[type=checkbox]').each(function() { this.checked = newstate; });
}

// relying on SITEPREFIX being in scope

$('#saved-searches-form').submit(function() {
  var data = [];
  $(this).find('input[type=checkbox]').each(function() {
    if (this.checked) { data.push(this.value); }
  });
  var map = { "action": "delete", "searchid": data };
  $.post(SITEPREFIX+'/deletesearches', JSON.stringify(map), function(resp) {
    if (data['success']==='defined') {
      // for now reload; could just hide the appropriate divs
      window.location.reload();
    }
  });
});
    
$('#saved-pubs-form').submit(function() {
  var data = [];
  $(this).find('input[type=checkbox]').each(function() {
    if (this.checked) { data.push(this.value); }
  });
  var map = { "action": "delete", "pubid": data };
  $.post(SITEPREFIX+'/deletepubs', JSON.stringify(map), function(resp) {
    if (data['success']==='defined') {
      // for now reload; could just hide the appropriate divs
      window.location.reload();
    }
  });
});
    
	</script>
</div>
